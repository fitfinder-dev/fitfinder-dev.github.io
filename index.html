<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitFinder Redirect</title>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const userId = window.location.hash.substring(1); // Removes the '#' character
      if (userId && isValidUUID(userId)) {
        // Build the JSON object for the deep link
        const props = JSON.stringify({ id: userId });
        const encodedProps = encodeURIComponent(props);

        // Construct the app URL
        const appUrl = `fitfinder://trainer/${encodedProps}`;
        const appStoreUrl = "https://apps.apple.com/us/app/fitfinder/id6483939610";

        // Create a timeout to redirect to the App Store if the app doesn't open
        const fallbackTimeout = setTimeout(() => {
          window.location.href = appStoreUrl;
        }, 3500); // Wait 3.5 seconds

        // Attempt to open the app
        window.location.href = appUrl;

        // Clear the fallback if the user navigates away from the page (indicating the app opened)
        window.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "hidden") {
            clearTimeout(fallbackTimeout);
          }
        });
      } else {
        console.error("Invalid or missing user ID.");
      }

      function isValidUUID(uuid) {
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
        return uuidRegex.test(uuid);
      }
    });
  </script>
</head>
<body>
  <h1>Redirecting...</h1>
  <p>If you are not redirected automatically after 5 seconds, <a id="fallback-link" href="#">click here</a>.</p>
  <script>
    document.getElementById("fallback-link").href = "https://apps.apple.com/us/app/fitfinder/id6483939610";
  </script>
</body>
</html>
